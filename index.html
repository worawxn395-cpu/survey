<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  font-family:Segoe UI;
  background:#f1f5f9;
  padding:20px;
}

h2{
  text-align:center;
  margin-bottom:30px;
}

.card{
  background:white;
  padding:20px;
  border-radius:16px;
  box-shadow:0 6px 15px rgba(0,0,0,0.08);
  margin-bottom:20px;
  animation:fadeIn 0.3s ease;
}

.question{
  font-weight:600;
  margin-bottom:10px;
}

.emoji-group{
  display:flex;
  justify-content:space-between;
  max-width:300px;
}

.emoji{
  font-size:26px;
  cursor:pointer;
  padding:8px;
  border-radius:50%;
  transition:all 0.2s ease;
}

.emoji:hover{
  transform:scale(1.2);
}

.selected{
  background:#3b82f6;
  color:white;
  transform:scale(1.3);
  box-shadow:0 4px 10px rgba(59,130,246,0.4);
}

.faded{
  opacity:0.4;
}

button.submit{
  display:block;
  margin:30px auto;
  padding:10px 30px;
  font-size:16px;
  border:none;
  border-radius:30px;
  background:#10b981;
  color:white;
  cursor:pointer;
}

button.submit:hover{
  background:#059669;
}

.success{
  text-align:center;
  color:#059669;
  display:none;
  font-weight:bold;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px);}
  to{opacity:1;transform:translateY(0);}
}
</style>
</head>

<body>

<h2>แบบประเมินความพึงพอใจ</h2>

<div id="form"></div>

<button class="submit" onclick="submitForm()">ส่งแบบประเมิน</button>

<div class="success" id="successMsg">
✅ ส่งข้อมูลเรียบร้อยแล้ว
</div>

<script>

let answers = {};
let totalQuestions = 0;

google.script.run.withSuccessHandler(loadQuestions).getQuestions();

function loadQuestions(data){

  const form = document.getElementById("form");
  totalQuestions = data.length;

  data.forEach((row,index)=>{

    const question = row[0];
    const emojis = row.slice(1);

    const card = document.createElement("div");
    card.className="card";

    const title = document.createElement("div");
    title.className="question";
    title.innerText = question;

    const group = document.createElement("div");
    group.className="emoji-group";

    emojis.forEach(e=>{
      const span=document.createElement("span");
      span.className="emoji";
      span.innerText=e;

      span.onclick=()=>{
        selectEmoji(span,index);
      };

      group.appendChild(span);
    });

    card.appendChild(title);
    card.appendChild(group);
    form.appendChild(card);
  });
}

function selectEmoji(element,index){

  const group = element.parentElement;
  const all = group.querySelectorAll(".emoji");

  all.forEach(e=>{
    e.classList.remove("selected");
    e.classList.add("faded");
  });

  element.classList.remove("faded");
  element.classList.add("selected");

  answers[index] = element.innerText;
}

function submitForm(){

  if(Object.keys(answers).length !== totalQuestions){
    alert("กรุณาตอบให้ครบทุกข้อ");
    return;
  }

  google.script.run.saveData(answers);

  document.getElementById("successMsg").style.display="block";
}

</script>

</body>
</html>
